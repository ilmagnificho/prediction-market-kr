<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì‚¬ì´íŠ¸ ë§ˆì¼“ - ë¯¸ë˜ ì˜ˆì¸¡ ì±Œë¦°ì§€</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f8f9fa;
        }
        
        .vote-bar {
            transition: width 0.3s ease;
        }
        
        .comment-item {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-primary:hover {
            opacity: 0.9;
        }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ê³ ì • */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 28rem; /* max-w-md */
            margin: 0 auto;
            z-index: 50; 
        }

        /* Polymarket ìŠ¤íƒ€ì¼ì˜ ê±°ë˜ íƒ­ */
        .trade-tab-active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
            font-weight: 700;
        }
        .trade-tab-inactive {
            border-bottom: 1px solid #e5e7eb;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ì´ˆê¸° ë°ì´í„° (PoolsëŠ” ìœ ì§€í•˜ë˜ Price ê°œë… ë„ì…) ---
        const initialPolls = [
            {
                id: 1,
                question: "2025ë…„ ì½”ìŠ¤í”¼ 3000 ëŒíŒŒí• ê¹Œ?",
                category: "ê²½ì œ",
                yesPool: 245000,
                noPool: 189000,
                endDate: "2025-12-31",
                comments: [
                    { id: 1, author: "ìµëª…1", text: "[YES ì˜ˆì¸¡ ê·¼ê±°] ê¸ˆë¦¬ ì¸í•˜ë˜ë©´ ê°€ëŠ¥í• ë“¯", time: "5ë¶„ ì „", likes: 12 },
                    { id: 2, author: "ìµëª…2", text: "[NO ì˜ˆì¸¡ ê·¼ê±°] ã„´ã„´ ë¯¸êµ­ ê²½ê¸° ë‘”í™” ì˜¤ë©´ í˜ë“¦", time: "10ë¶„ ì „", likes: 8 }
                ]
            },
            {
                id: 2,
                question: "ì†í¥ë¯¼ ì´ë²ˆ ì‹œì¦Œ 20ê³¨ ì´ìƒ?",
                category: "ìŠ¤í¬ì¸ ",
                yesPool: 412000,
                noPool: 278000,
                endDate: "2025-05-31",
                comments: [
                    { id: 3, author: "ì¶•êµ¬íŒ¬", text: "[YES ì˜ˆì¸¡ ê·¼ê±°] í¼ ë¯¸ì³¤ìŒ ã…‡ã…ˆ?", time: "1ì‹œê°„ ì „", likes: 34 }
                ]
            },
            {
                id: 3,
                question: "ì˜¬í•´ ì• í”Œ í´ë”ë¸” ì•„ì´í° ì¶œì‹œ?",
                category: "í…Œí¬",
                yesPool: 15600,
                noPool: 52300,
                endDate: "2025-12-31",
                comments: []
            },
            {
                id: 4,
                question: "ì„œìš¸ ì§‘ê°’ ì—°ë§ê¹Œì§€ 10% ì´ìƒ í•˜ë½?",
                category: "ë¶€ë™ì‚°",
                yesPool: 389000,
                noPool: 412000,
                endDate: "2025-12-31",
                comments: [
                    { id: 4, author: "ë¶€ë¦°ì´", text: "[NO ì˜ˆì¸¡ ê·¼ê±°] ê¸ˆë¦¬ ë™ê²°ì´ë¼ ë” ì•ˆë–¨ì–´ì§ˆë“¯", time: "30ë¶„ ì „", likes: 15 }
                ]
            }
        ];

        // --- ì„ì‹œ ë¦¬ë”ë³´ë“œ ë°ì´í„° (ê²Œì„ ìš”ì†Œ ìœ ì§€) ---
        const fakeLeaderboard = [
            { id: 1, name: 'ì˜ˆì§€ë ¥ ë§ˆìŠ¤í„°', coins: 1500000 },
            { id: 2, name: 'ì •ì±… ë¶„ì„ê°€', coins: 950000 },
            { id: 3, name: 'ê²½ì œì˜ ì‹ ', coins: 720000 },
        ];
        
        // --- ìœ ì € ë°ì´í„° (positions ì¶”ê°€: í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬ë¥¼ ìœ„í•¨) ---
        const initialUser = { 
            name: 'ì´ˆë³´ ì˜ˆì–¸ê°€', 
            coins: 10000, 
            positions: [] // { pollId: 1, yesCommit: 500, noCommit: 0 } í˜•íƒœë¡œ ì €ì¥
        };

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        // í’€ ë¹„ìœ¨ì„ 0~100 ì‚¬ì´ì˜ ê°€ê²©ìœ¼ë¡œ ê³„ì‚° (Price = Probability)
        const calculatePrice = (yesPool, noPool) => {
            const total = yesPool + noPool;
            if (total === 0) return 50; // ê±°ë˜ ì—†ìœ¼ë©´ 50 ì½”ì¸ (50% í™•ë¥ )
            return Math.round((yesPool / total) * 100); // YES ê°€ê²©
        };

        // --- App ì»´í¬ë„ŒíŠ¸ ---
        function App() {
            // Polls ìƒíƒœ ê´€ë¦¬ (ì´ì „ê³¼ ë™ì¼)
            const [polls, setPolls] = useState(() => {
                try {
                    const saved = localStorage.getItem('polls');
                    if (saved) {
                        const parsedPolls = JSON.parse(saved);
                        if (Array.isArray(parsedPolls) && parsedPolls.length > 0 && parsedPolls[0].hasOwnProperty('yesPool')) {
                            return parsedPolls;
                        }
                    }
                } catch (e) { console.error("Polls load error", e); localStorage.removeItem('polls'); }
                return initialPolls;
            });
            
            // User ìƒíƒœ ê´€ë¦¬ (positions í•„ë“œ ì¶”ê°€)
            const [user, setUser] = useState(() => {
                try {
                    const savedUser = localStorage.getItem('user');
                    if (savedUser) {
                        const parsedUser = JSON.parse(savedUser);
                        if (parsedUser && parsedUser.hasOwnProperty('coins')) {
                             // positions í•„ë“œê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™” (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
                            if (!parsedUser.hasOwnProperty('positions')) {
                                parsedUser.positions = []; 
                            }
                            return parsedUser;
                        }
                    }
                } catch (e) { console.error("User load error", e); localStorage.removeItem('user'); }
                return initialUser;
            });

            // ë·° ê´€ë¦¬
            const [currentView, setCurrentView] = useState('market'); // market(home), portfolio, create, detail
            const [selectedPoll, setSelectedPoll] = useState(null);
            
            // ì±Œë¦°ì§€ ìƒì„± í¼ ìƒíƒœëŠ” ì´ì „ê³¼ ë™ì¼
            const [newPollQuestion, setNewPollQuestion] = useState('');
            const [newPollCategory, setNewPollCategory] = useState('ì¼ë°˜');
            const [newPollEndDate, setNewPollEndDate] = useState('');
            
            const [commentText, setCommentText] = useState('');

            // LocalStorage ì €ì¥ íš¨ê³¼ (pollsì™€ user ëª¨ë‘ ì €ì¥)
            useEffect(() => { localStorage.setItem('polls', JSON.stringify(polls)); }, [polls]);
            useEffect(() => { localStorage.setItem('user', JSON.stringify(user)); }, [user]);


            // --- 3. í•µì‹¬ ê±°ë˜ í•¨ìˆ˜ (BUY / SELL) ---

            // 'êµ¬ë§¤(BUY)' í•¨ìˆ˜ (ì½”ì¸ í’€ê³¼ í¬ì§€ì…˜ì— ì½”ì¸ ì¶”ê°€)
            const handleTradeBuy = (pollId, tradeType, amount) => {
                const tradeAmount = parseInt(amount, 10);
                if (isNaN(tradeAmount) || tradeAmount <= 0) {
                    alert('ì½”ì¸ ìˆ˜ëŸ‰ì„ 1 ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (tradeAmount > user.coins) {
                    alert('ë³´ìœ  ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                    return;
                }

                // 1. ìœ ì € ì½”ì¸ ì°¨ê°
                setUser(prev => ({ ...prev, coins: prev.coins - tradeAmount }));

                // 2. ì±Œë¦°ì§€ í’€(Pool)ì— ì½”ì¸ ì¶”ê°€
                const isYesTrade = tradeType === 'yes';
                setPolls(polls.map(poll => {
                    if (poll.id === pollId) {
                        if (isYesTrade) {
                            return { ...poll, yesPool: poll.yesPool + tradeAmount };
                        } else {
                            return { ...poll, noPool: poll.noPool + tradeAmount };
                        }
                    }
                    return poll;
                }));

                // 3. ìœ ì € í¬ì§€ì…˜ ì—…ë°ì´íŠ¸ (committedCoins ê¸°ë¡)
                setUser(prev => {
                    const existingPosition = prev.positions.find(p => p.pollId === pollId);
                    
                    if (existingPosition) {
                        // ê¸°ì¡´ í¬ì§€ì…˜ ì—…ë°ì´íŠ¸
                        const updatedPositions = prev.positions.map(p => {
                            if (p.pollId === pollId) {
                                return {
                                    ...p,
                                    yesCommit: p.yesCommit + (isYesTrade ? tradeAmount : 0),
                                    noCommit: p.noCommit + (isYesTrade ? 0 : tradeAmount)
                                };
                            }
                            return p;
                        });
                        return { ...prev, positions: updatedPositions };
                    } else {
                        // ìƒˆ í¬ì§€ì…˜ ìƒì„±
                        const newPosition = {
                            pollId: pollId,
                            yesCommit: isYesTrade ? tradeAmount : 0,
                            noCommit: isYesTrade ? 0 : tradeAmount,
                            // entryPrice: [] // ë³µì¡ì„± ì œê±°ë¥¼ ìœ„í•´ entryPriceëŠ” ê¸°ë¡í•˜ì§€ ì•ŠìŒ
                        };
                        return { ...prev, positions: [...prev.positions, newPosition] };
                    }
                });

                alert(`${tradeAmount.toLocaleString()} ì½”ì¸ìœ¼ë¡œ ${tradeType.toUpperCase()} ì£¼ì‹ êµ¬ë§¤ ì™„ë£Œ!`);
            };

            // 'íŒë§¤(SELL)' í•¨ìˆ˜ (ì»¤ë°‹ëœ ì½”ì¸ì˜ ì¼ë¶€ë¥¼ í˜„ì¬ ê°€ê²©ìœ¼ë¡œ í™˜ìˆ˜ ì‹œë®¬ë ˆì´ì…˜)
            const handleTradeSell = (pollId, tradeType, amount) => {
                const tradeAmount = parseInt(amount, 10);
                if (isNaN(tradeAmount) || tradeAmount <= 0) {
                    alert('ì½”ì¸ ìˆ˜ëŸ‰ì„ 1 ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const poll = polls.find(p => p.id === pollId);
                const position = user.positions.find(p => p.pollId === pollId);

                if (!poll || !position) {
                    alert("ì˜ëª»ëœ ê±°ë˜ì…ë‹ˆë‹¤.");
                    return;
                }

                const isYesTrade = tradeType === 'yes';
                const committed = isYesTrade ? position.yesCommit : position.noCommit;

                if (tradeAmount > committed) {
                    alert(`í˜„ì¬ ì»¤ë°‹ëœ ì½”ì¸ (${committed.toLocaleString()} ì½”ì¸) ì´ìƒì„ íŒë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                    return;
                }

                const currentPrice = isYesTrade 
                    ? calculatePrice(poll.yesPool, poll.noPool) 
                    : 100 - calculatePrice(poll.yesPool, poll.noPool);
                
                // í™˜ìˆ˜í•  ì½”ì¸: íŒë§¤ëŸ‰ * í˜„ì¬ ê°€ê²© / 100 (100 ì½”ì¸ì´ 100% ê°€ì¹˜)
                const refundCoins = Math.round(tradeAmount * (currentPrice / 100)); 
                const profitOrLoss = refundCoins - tradeAmount; // ìˆ˜ìµ/ì†ì‹¤ ì‹œë®¬ë ˆì´ì…˜ (ë‹¨ìˆœí™”ëœ ë°©ì‹)

                // 1. ìœ ì € ì½”ì¸ ì¦ê°€ (í™˜ìˆ˜ì•¡ ì§€ê¸‰)
                setUser(prev => ({ ...prev, coins: prev.coins + refundCoins }));

                // 2. ì±Œë¦°ì§€ í’€(Pool)ì—ì„œ íŒë§¤ ì½”ì¸ë§Œí¼ ì°¨ê°
                setPolls(polls.map(p => {
                    if (p.id === pollId) {
                        if (isYesTrade) {
                            return { ...p, yesPool: p.yesPool - tradeAmount };
                        } else {
                            return { ...p, noPool: p.noPool - tradeAmount };
                        }
                    }
                    return p;
                }));

                // 3. ìœ ì € í¬ì§€ì…˜ ì—…ë°ì´íŠ¸ (committedCoins ì°¨ê°)
                setUser(prev => {
                    const updatedPositions = prev.positions.map(p => {
                        if (p.pollId === pollId) {
                            return {
                                ...p,
                                yesCommit: p.yesCommit - (isYesTrade ? tradeAmount : 0),
                                noCommit: p.noCommit - (isYesTrade ? 0 : tradeAmount)
                            };
                        }
                        return p;
                    }).filter(p => p.yesCommit > 0 || p.noCommit > 0); // 0ì´ ë˜ë©´ í¬ì§€ì…˜ì—ì„œ ì œê±°

                    return { ...prev, positions: updatedPositions };
                });

                alert(`${tradeAmount.toLocaleString()} ì½”ì¸ì„ ${currentPrice} ì½”ì¸ ê°€ê²©ìœ¼ë¡œ íŒë§¤ (í™˜ìˆ˜ì•¡: ${refundCoins.toLocaleString()} ì½”ì¸)`);
            };

            // ê¸°íƒ€ ê¸°ëŠ¥ (ëŒ“ê¸€, ë³´ë„ˆìŠ¤ ë“±)ì€ ì´ì „ê³¼ ë™ì¼
            const addComment = (pollId, text, isAuto = false) => {
                if (!text.trim()) {
                    if(!isAuto) alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                setPolls(polls.map(poll => {
                    if (poll.id === pollId) {
                        const newComment = {
                            id: Date.now(),
                            author: user.name, 
                            text: text,
                            time: 'ë°©ê¸ˆ ì „',
                            likes: 0
                        };
                        return { ...poll, comments: [newComment, ...poll.comments] };
                    }
                    return poll;
                }));
                
                setCommentText(''); 
            };
            
            const getDailyBonus = () => {
                setUser(prev => ({ ...prev, coins: prev.coins + 1000 }));
                alert('ë°ì¼ë¦¬ ë³´ë„ˆìŠ¤ 1,000 ì½”ì¸ íšë“! ğŸª™');
            };

            const createPoll = () => {
                // ... (ìƒëµ: ì´ì „ ì½”ë“œì™€ ë™ì¼)
                if (!newPollQuestion.trim() || !newPollEndDate) {
                    alert('ì§ˆë¬¸ê³¼ ì¢…ë£Œì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }

                const newPoll = {
                    id: Date.now(),
                    question: newPollQuestion,
                    category: newPollCategory,
                    yesPool: 0, 
                    noPool: 0,
                    endDate: newPollEndDate,
                    comments: []
                };

                setPolls([newPoll, ...polls]);
                setNewPollQuestion('');
                setNewPollCategory('ì¼ë°˜');
                setNewPollEndDate('');
                setCurrentView('market');
            };
            
            const viewPollDetail = (poll) => {
                setSelectedPoll(poll);
                setCurrentView('detail');
            };


            // --- UI ì»´í¬ë„ŒíŠ¸ ---
            
            // ì±Œë¦°ì§€ ì¹´ë“œ (ë§ˆì¼“ í™”ë©´) - 'ê°€ê²©' í‘œì‹œë¡œ ë³€ê²½
            const PollCard = ({ poll }) => {
                const totalPool = poll.yesPool + poll.noPool;
                const yesPrice = calculatePrice(poll.yesPool, poll.noPool);
                const noPrice = 100 - yesPrice;

                return (
                    <div 
                        className="bg-white rounded-lg p-4 mb-3 shadow-sm cursor-pointer hover:shadow-md transition-shadow"
                        onClick={() => viewPollDetail(poll)}
                    >
                        <div className="flex items-start justify-between mb-2">
                            <span className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-medium">
                                {poll.category}
                            </span>
                            <span className="text-xs text-gray-500">ë§ˆê°: {poll.endDate}</span>
                        </div>
                        
                        <h3 className="text-base font-bold mb-3 text-gray-800 leading-snug">
                            {poll.question}
                        </h3>
                        
                        {/* --- ê°€ê²© í‘œì‹œ (Polymarket ìŠ¤íƒ€ì¼) --- */}
                        <div className="flex justify-between items-center mb-3">
                            <div className="text-sm font-medium text-gray-600">YES ì£¼ì‹ ê°€ê²©</div>
                            <div className={`text-2xl font-extrabold ${yesPrice >= 50 ? 'text-green-600' : 'text-red-600'}`}>
                                {yesPrice} ì½”ì¸
                            </div>
                        </div>

                        <div className="flex items-center">
                            <span className="text-xs font-medium text-green-600 w-8">YES</span>
                            <div className="flex-1 bg-gray-100 rounded-full h-4 overflow-hidden">
                                <div 
                                    className="vote-bar bg-gradient-to-r from-green-400 to-green-500 h-full"
                                    style={{ width: `${yesPrice}%` }}
                                ></div>
                            </div>
                            <span className="text-xs font-medium text-red-600 w-8 text-right">NO</span>
                        </div>
                        
                        <div className="flex items-center justify-between text-xs text-gray-500 mt-2">
                            <span>ì´ {totalPool.toLocaleString()} ì½”ì¸ ê±°ë˜</span>
                            <span>ğŸ’¬ {poll.comments.length}ê°œ í† ë¡ </span>
                        </div>
                    </div>
                );
            };

            // ë§ˆì¼“ í™”ë©´ (êµ¬: í™ˆ í™”ë©´)
            const MarketScreen = () => (
                <div className="min-h-screen pb-24">
                    <div className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-md mx-auto px-4 py-4">
                            <div className="flex justify-between items-center">
                                <h1 className="text-2xl font-bold text-gray-800">ğŸ”® ì˜ˆì¸¡ ë§ˆì¼“</h1>
                                <div className="text-right">
                                    <span className="font-bold text-purple-700">ğŸª™ {user.coins.toLocaleString()}</span>
                                    <div className="text-xs text-gray-600">{user.name}</div>
                                </div>
                            </div>
                            <p className="text-sm text-gray-600 mt-1">ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•˜ê³  ê±°ë˜ ì°¨ìµì„ ì–»ìœ¼ì„¸ìš”!</p>
                            <button 
                                onClick={getDailyBonus}
                                className="text-xs bg-yellow-300 text-yellow-900 font-medium px-3 py-1 rounded-full hover:bg-yellow-400 mt-3"
                            >
                                ğŸ ë°ì¼ë¦¬ ë³´ë„ˆìŠ¤
                            </button>
                        </div>
                    </div>

                    <div className="max-w-md mx-auto px-4 py-4">
                        <h2 className="text-lg font-bold text-gray-800 mb-4">ğŸ”¥ í˜„ì¬ ê±°ë˜ ê°€ëŠ¥í•œ ë§ˆì¼“</h2>
                        
                        {polls.map(poll => (
                            <PollCard key={poll.id} poll={poll} />
                        ))}
                    </div>
                </div>
            );

            // ë‚´ í¬ì§€ì…˜ í™”ë©´ (êµ¬: ë­í‚¹ í™”ë©´)
            const PortfolioScreen = () => {
                const myRank = { id: 'my', name: `${user.name} (ë‚˜)`, coins: user.coins };
                const sortedLeaderboard = [...fakeLeaderboard, myRank].sort((a, b) => b.coins - a.coins);
                
                const currentPositions = user.positions.map(pos => {
                    const poll = polls.find(p => p.id === pos.pollId);
                    if (!poll) return null;

                    const yesPrice = calculatePrice(poll.yesPool, poll.noPool);
                    const noPrice = 100 - yesPrice;

                    const yesValue = pos.yesCommit * (yesPrice / 100); // í˜„ì¬ ê°€ì¹˜
                    const noValue = pos.noCommit * (noPrice / 100);

                    // í¬íŠ¸í´ë¦¬ì˜¤ í™”ë©´ì—ëŠ” ë§¤ìˆ˜ ë‹¨ê°€ë¥¼ ëª¨ë¥´ë¯€ë¡œ, ë‹¨ìˆœí™”ëœ ìˆ˜ìµë¥ ë§Œ í‘œì‹œ
                    // ì—¬ê¸°ì„œëŠ” ì»¤ë°‹í•œ ì½”ì¸ (ì›ê¸ˆ) ëŒ€ë¹„ í˜„ì¬ ê°€ì¹˜ë¡œ ì†ìµì„ ì‹œë®¬ë ˆì´ì…˜
                    const yesProfit = yesValue - pos.yesCommit;
                    const noProfit = noValue - pos.noCommit;

                    return {
                        ...pos,
                        question: poll.question,
                        yesPrice,
                        noPrice,
                        yesValue,
                        noValue,
                        yesProfit,
                        noProfit
                    };
                }).filter(p => p !== null);

                const totalPortfolioValue = currentPositions.reduce((sum, p) => sum + p.yesValue + p.noValue, 0);

                return (
                    <div className="min-h-screen pb-24">
                        <div className="bg-white shadow-sm sticky top-0 z-10">
                            <div className="max-w-md mx-auto px-4 py-4">
                                <h1 className="text-2xl font-bold text-gray-800">ğŸ’¼ ë‚´ í¬ì§€ì…˜</h1>
                                <p className="text-sm text-gray-600 mt-1">ì´ ìì‚°: <span className="font-bold text-purple-700">ğŸª™ {(user.coins + totalPortfolioValue).toLocaleString()}</span></p>
                            </div>
                        </div>

                        <div className="max-w-md mx-auto px-4 py-4">
                            <h2 className="text-lg font-bold text-gray-800 mb-4">ë‚˜ì˜ ë³´ìœ  í˜„í™©</h2>
                            {currentPositions.length === 0 ? (
                                <div className="text-center py-8 text-gray-500 bg-white rounded-lg shadow-sm">
                                    <div className="text-4xl mb-2">ğŸ“‰</div>
                                    <div className="text-sm">ë³´ìœ  ì¤‘ì¸ ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆì¼“ì—ì„œ êµ¬ë§¤í•´ë³´ì„¸ìš”!</div>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {currentPositions.map(p => (
                                        <div key={p.pollId} className="bg-white p-4 rounded-lg shadow-md border-l-4 border-purple-500">
                                            <h3 className="font-bold text-gray-800 mb-2">{p.question}</h3>
                                            
                                            {p.yesCommit > 0 && (
                                                <div className="flex justify-between text-sm py-1 border-b">
                                                    <span className="font-medium text-green-600">âœ… YES ì£¼ì‹</span>
                                                    <span>ì»¤ë°‹: {p.yesCommit.toLocaleString()} ì½”ì¸</span>
                                                    <span className="font-bold text-gray-800">í˜„ì¬ê°€: {p.yesPrice} ì½”ì¸</span>
                                                    <span className={`font-bold ${p.yesProfit >= 0 ? 'text-green-500' : 'text-red-500'}`}>
                                                        {p.yesProfit >= 0 ? 'â–²' : 'â–¼'} {p.yesProfit.toLocaleString()}
                                                    </span>
                                                </div>
                                            )}
                                            {p.noCommit > 0 && (
                                                <div className="flex justify-between text-sm py-1">
                                                    <span className="font-medium text-red-600">âŒ NO ì£¼ì‹</span>
                                                    <span>ì»¤ë°‹: {p.noCommit.toLocaleString()} ì½”ì¸</span>
                                                    <span className="font-bold text-gray-800">í˜„ì¬ê°€: {p.noPrice} ì½”ì¸</span>
                                                    <span className={`font-bold ${p.noProfit >= 0 ? 'text-green-500' : 'text-red-500'}`}>
                                                        {p.noProfit >= 0 ? 'â–²' : 'â–¼'} {p.noProfit.toLocaleString()}
                                                    </span>
                                                </div>
                                            )}
                                            <button 
                                                onClick={() => viewPollDetail(polls.find(poll => poll.id === p.pollId))}
                                                className="mt-3 w-full text-xs text-purple-600 font-medium py-1 border border-purple-300 rounded hover:bg-purple-50"
                                            >
                                                ê±°ë˜ í™”ë©´ìœ¼ë¡œ ì´ë™
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* ë¦¬ë”ë³´ë“œëŠ” í¬íŠ¸í´ë¦¬ì˜¤ í™”ë©´ í•˜ë‹¨ì— ë°°ì¹˜ (ê²Œì„ ìš”ì†Œ ìœ ì§€) */}
                            <h2 className="text-lg font-bold text-gray-800 mt-8 mb-4">ğŸ† ì½”ì¸ ë¶€ì ë­í‚¹</h2>
                            {sortedLeaderboard.map((u, index) => (
                                <div 
                                    key={u.id}
                                    className={`flex items-center justify-between p-3 mb-2 rounded-lg ${u.id === 'my' ? 'bg-purple-100 border-2 border-purple-500' : 'bg-white shadow-sm'}`}
                                >
                                    <div className="flex items-center">
                                        <span className="text-lg font-bold w-10">
                                            {index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`}
                                        </span>
                                        <span className="font-medium text-gray-800">{u.name}</span>
                                    </div>
                                    <span className="font-bold text-purple-700">
                                        ğŸª™ {u.coins.toLocaleString()}
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // ì±Œë¦°ì§€ ìƒì„¸ ë° ê±°ë˜ í™”ë©´ (Trade Widget ë„ì…)
            const PollDetailScreen = () => {
                // ... (ìƒëµ: ìœ íš¨ì„± ê²€ì‚¬)
                if (!selectedPoll) { setCurrentView('market'); return null; }
                const poll = polls.find(p => p.id === selectedPoll.id);
                if (!poll) { setCurrentView('market'); return null; }

                // ê°€ê²© ê³„ì‚°
                const yesPrice = calculatePrice(poll.yesPool, poll.noPool);
                const noPrice = 100 - yesPrice;
                const totalPool = poll.yesPool + poll.noPool;

                // í¬ì§€ì…˜ ë°ì´í„°
                const position = user.positions.find(p => p.pollId === poll.id) || { yesCommit: 0, noCommit: 0 };

                // ê±°ë˜ ìœ„ì ¯ ìƒíƒœ
                const [tradeTab, setTradeTab] = useState('buy'); // buy or sell
                const [tradeType, setTradeType] = useState('yes'); // yes or no
                const [tradeAmount, setTradeAmount] = useState(100);

                const currentPrice = tradeType === 'yes' ? yesPrice : noPrice;
                const committedCoins = tradeType === 'yes' ? position.yesCommit : position.noCommit;

                // êµ¬ë§¤ ì‹œ ì˜ˆìƒ ë¹„ìš© (amountë§Œí¼ ì½”ì¸ì„ í’€ì— ë„£ìœ¼ë¯€ë¡œ, ë‹¨ìˆœ amount)
                const estimatedCost = tradeAmount; 
                // íŒë§¤ ì‹œ ì˜ˆìƒ í™˜ìˆ˜ì•¡ (íŒë§¤ ìˆ˜ëŸ‰ * í˜„ì¬ ê°€ê²© / 100)
                const estimatedRefund = Math.round(tradeAmount * (currentPrice / 100));

                return (
                    <div className="min-h-screen bg-gray-50 pb-20">
                        <div className="max-w-md mx-auto bg-white min-h-screen">
                            {/* Header */}
                            <div className="sticky top-0 bg-white border-b z-10 p-4">
                                <button onClick={() => setCurrentView('market')} className="text-gray-600 mb-2">â† ë§ˆì¼“ìœ¼ë¡œ</button>
                            </div>

                            {/* Poll Info */}
                            <div className="p-4 border-b">
                                <div className="flex items-center justify-between mb-3">
                                    <span className="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-medium">{poll.category}</span>
                                    <span className="text-xs text-gray-500">ë§ˆê°: {poll.endDate}</span>
                                </div>
                                <h2 className="text-xl font-bold text-gray-800 mb-4 leading-tight">{poll.question}</h2>

                                {/* --- ê±°ë˜ ìœ„ì ¯ (Trade Widget) --- */}
                                <div className="bg-gray-50 rounded-lg p-4 space-y-4">
                                    {/* 1. Buy / Sell íƒ­ */}
                                    <div className="flex border-b border-gray-300">
                                        <button 
                                            onClick={() => setTradeTab('buy')}
                                            className={`flex-1 text-sm py-2 transition-colors ${tradeTab === 'buy' ? 'trade-tab-active' : 'trade-tab-inactive'}`}
                                        >êµ¬ë§¤ (BUY)</button>
                                        <button 
                                            onClick={() => setTradeTab('sell')}
                                            className={`flex-1 text-sm py-2 transition-colors ${tradeTab === 'sell' ? 'trade-tab-active' : 'trade-tab-inactive'}`}
                                        >íŒë§¤ (SELL)</button>
                                    </div>
                                    
                                    {/* 2. Yes / No ì£¼ì‹ ì„ íƒ */}
                                    <div className="grid grid-cols-2 gap-2">
                                        <button
                                            onClick={() => setTradeType('yes')}
                                            className={`py-3 rounded-lg font-bold border-2 ${tradeType === 'yes' ? 'bg-green-100 border-green-500 text-green-700' : 'bg-white border-gray-300 text-gray-600'}`}
                                        >âœ… YES ({yesPrice} ì½”ì¸)</button>
                                        <button
                                            onClick={() => setTradeType('no')}
                                            className={`py-3 rounded-lg font-bold border-2 ${tradeType === 'no' ? 'bg-red-100 border-red-500 text-red-700' : 'bg-white border-gray-300 text-gray-600'}`}
                                        >âŒ NO ({noPrice} ì½”ì¸)</button>
                                    </div>

                                    {/* 3. ìˆ˜ëŸ‰ ì…ë ¥ */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">ê±°ë˜ ì½”ì¸ ìˆ˜ëŸ‰</label>
                                        <input
                                            type="number"
                                            value={tradeAmount}
                                            onChange={(e) => setTradeAmount(e.target.value)}
                                            className="w-full border border-gray-300 rounded-lg p-2 text-center font-bold text-lg"
                                        />
                                    </div>

                                    {/* 4. ê±°ë˜ ì •ë³´ ìš”ì•½ */}
                                    <div className="text-sm space-y-1 pt-2 border-t border-gray-200">
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">í˜„ì¬ ê°€ê²©:</span>
                                            <span className="font-bold text-purple-700">{currentPrice} ì½”ì¸</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">{tradeTab === 'buy' ? 'ì˜ˆìƒ ë¹„ìš©:' : 'í™˜ìˆ˜í•  ì½”ì¸:'}</span>
                                            <span className="font-bold text-gray-800">
                                                {tradeTab === 'buy' ? estimatedCost.toLocaleString() : estimatedRefund.toLocaleString()} ì½”ì¸
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ë³´ìœ  ì½”ì¸ / {tradeType.toUpperCase()} ì»¤ë°‹ ì½”ì¸:</span>
                                            <span className="font-bold">{user.coins.toLocaleString()} / {committedCoins.toLocaleString()} ì½”ì¸</span>
                                        </div>
                                    </div>
                                    
                                    {/* 5. ìµœì¢… ê±°ë˜ ë²„íŠ¼ */}
                                    {tradeTab === 'buy' ? (
                                        <button
                                            onClick={() => handleTradeBuy(poll.id, tradeType, tradeAmount)}
                                            className="w-full bg-green-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-green-600 transition-all"
                                        >
                                            {tradeType.toUpperCase()} ì£¼ì‹ {tradeAmount.toLocaleString()} ì½”ì¸ êµ¬ë§¤í•˜ê¸°
                                        </button>
                                    ) : (
                                        <button
                                            onClick={() => handleTradeSell(poll.id, tradeType, tradeAmount)}
                                            className="w-full bg-red-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-red-600 transition-all"
                                            disabled={tradeAmount > committedCoins}
                                        >
                                            {tradeType.toUpperCase()} ì£¼ì‹ {tradeAmount.toLocaleString()} ì½”ì¸ íŒë§¤í•˜ê¸°
                                        </button>
                                    )}
                                </div>
                            </div>
                            
                            {/* ì‹œì¥ í˜„í™© (Market Overview) */}
                            <div className="p-4 border-b">
                                <h3 className="text-lg font-bold text-gray-800 mb-3">ì‹œì¥ í˜„í™©</h3>
                                <div className="bg-gray-50 rounded-lg p-4">
                                    <div className="flex justify-between items-center mb-3">
                                        <span className="text-sm font-bold text-gray-700">ì´ ê±°ë˜ì•¡ (Total Pool)</span>
                                        <span className="text-sm text-gray-600">ğŸª™ {totalPool.toLocaleString()} ì½”ì¸</span>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        <div>
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className="font-medium text-green-600">âœ… YES ê°€ê²©</span>
                                                <span className="font-bold text-green-600">{yesPrice} ì½”ì¸</span>
                                            </div>
                                            <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                                                <div 
                                                    className="vote-bar bg-gradient-to-r from-green-400 to-green-500 h-full"
                                                    style={{ width: `${yesPrice}%` }}
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className="font-medium text-red-600">âŒ NO ê°€ê²©</span>
                                                <span className="font-bold text-red-600">{noPrice} ì½”ì¸</span>
                                            </div>
                                            <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                                                <div 
                                                    className="vote-bar bg-gradient-to-r from-red-400 to-red-500 h-full"
                                                    style={{ width: `${noPrice}%` }}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* í† ë¡  ì„¹ì…˜ (Discussion) */}
                            <div className="p-4">
                                <h3 className="text-lg font-bold text-gray-800 mb-4">
                                    ğŸ’¬ ê·¼ê±° ë° í† ë¡  {poll.comments.length}
                                </h3>

                                <div className="mb-4 bg-gray-50 rounded-lg p-3">
                                    <div className="text-sm font-medium mb-2">{user.name} (ìœ¼)ë¡œ ëŒ“ê¸€ ë‹¬ê¸°:</div>
                                    <textarea
                                        value={commentText}
                                        onChange={(e) => setCommentText(e.target.value)}
                                        placeholder="ê±°ë˜ ê·¼ê±° ë° ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..."
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 mb-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        rows="2"
                                    />
                                    <button
                                        onClick={() => addComment(poll.id, commentText, false)}
                                        className="w-full btn-primary text-white font-medium py-2 rounded-lg text-sm"
                                    >
                                        í† ë¡  ì°¸ì—¬
                                    </button>
                                </div>

                                <div className="space-y-3">
                                    {poll.comments.length === 0 ? (
                                        <div className="text-center py-8 text-gray-500">
                                            <div className="text-4xl mb-2">ğŸ’­</div>
                                            <div className="text-sm">ì²« í† ë¡ ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</div>
                                        </div>
                                    ) : (
                                        poll.comments.map(comment => (
                                            <div key={comment.id} className="comment-item border-b pb-3">
                                                <div className="flex items-start justify-between mb-1">
                                                    <span className="font-medium text-sm text-gray-800">
                                                        {comment.author}
                                                    </span>
                                                    <span className="text-xs text-gray-500">{comment.time}</span>
                                                </div>
                                                <p className="text-sm text-gray-700 mb-2 leading-relaxed whitespace-pre-wrap">
                                                    {comment.text}
                                                </p>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // ì±Œë¦°ì§€ ìƒì„± í™”ë©´ (ì´ì „ê³¼ ë™ì¼)
            const CreatePollScreen = () => (
                <div className="min-h-screen bg-white pb-24">
                    <div className="max-w-md mx-auto">
                        <div className="flex items-center justify-center p-4 border-b relative">
                            <h2 className="text-lg font-bold">ìƒˆ ë§ˆì¼“ ë§Œë“¤ê¸°</h2>
                            <button 
                                onClick={createPoll}
                                className="text-purple-600 font-bold absolute right-4"
                            >
                                ì™„ë£Œ
                            </button>
                        </div>
                        <div className="p-4 space-y-4">
                            <div><label className="block text-sm font-medium text-gray-700 mb-2">ì§ˆë¬¸ *</label>
                                <textarea value={newPollQuestion} onChange={(e) => setNewPollQuestion(e.target.value)} placeholder="ì˜ˆ: 2025ë…„ ë¹„íŠ¸ì½”ì¸ 10ë§Œë¶ˆ ëŒíŒŒí• ê¹Œ?" className="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-purple-500" rows="3"/>
                            </div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
                                <select value={newPollCategory} onChange={(e) => setNewPollCategory(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option>ì¼ë°˜</option><option>ê²½ì œ</option><option>ìŠ¤í¬ì¸ </option><option>í…Œí¬</option><option>ë¶€ë™ì‚°</option><option>ì •ì¹˜</option><option>ì—°ì˜ˆ</option>
                                </select>
                            </div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-2">ì¢…ë£Œì¼ *</label>
                                <input type="date" value={newPollEndDate} onChange={(e) => setNewPollEndDate(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-purple-500"/>
                            </div>
                            <div className="bg-purple-50 rounded-lg p-4 mt-6">
                                <h3 className="font-bold text-purple-900 mb-2">ğŸ’¡ ë§ˆì¼“ ì‘ì„± íŒ</h3>
                                <ul className="text-sm text-purple-800 space-y-1"><li>â€¢ YES/NOë¡œ ë‹µë³€ ê°€ëŠ¥í•œ ì§ˆë¬¸ì´ ì¢‹ì•„ìš”</li><li>â€¢ ëª…í™•í•œ ê¸°ì¤€ê³¼ ê¸°í•œì„ ì„¤ì •í•´ì£¼ì„¸ìš”</li><li>â€¢ ë…¼ìŸì ì´ê³  ì¬ë¯¸ìˆëŠ” ì£¼ì œê°€ ì¸ê¸°!</li></ul>
                            </div>
                        </div>
                    </div>
                </div>
            );


            // í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜
            const BottomNav = () => (
                <div className="bottom-nav grid grid-cols-3 gap-1 bg-white shadow-inner border-t p-2">
                    <button
                        onClick={() => setCurrentView('market')}
                        className={`p-2 rounded-lg flex flex-col items-center ${currentView === 'market' ? 'text-purple-600' : 'text-gray-500'}`}
                    >
                        <span className="text-2xl">ğŸ“ˆ</span>
                        <span className="text-xs font-medium">ë§ˆì¼“</span>
                    </button>
                    <button
                        onClick={() => setCurrentView('portfolio')}
                        className={`p-2 rounded-lg flex flex-col items-center ${currentView === 'portfolio' ? 'text-purple-600' : 'text-gray-500'}`}
                    >
                        <span className="text-2xl">ğŸ’°</span>
                        <span className="text-xs font-medium">ë‚´ í¬ì§€ì…˜</span>
                    </button>
                    <button
                        onClick={() => setCurrentView('create')}
                        className={`p-2 rounded-lg flex flex-col items-center ${currentView === 'create' ? 'text-purple-600' : 'text-gray-500'}`}
                    >
                        <span className="text-2xl">âœï¸</span>
                        <span className="text-xs font-medium">ë§Œë“¤ê¸°</span>
                    </button>
                </div>
            );

            // --- 4. ë©”ì¸ ë Œë”ë§ ---
            return (
                <div className="max-w-md mx-auto">
                    {currentView === 'market' && <MarketScreen />}
                    {currentView === 'portfolio' && <PortfolioScreen />}
                    {currentView === 'create' && <CreatePollScreen />}
                    {currentView === 'detail' && <PollDetailScreen />}
                    
                    {currentView !== 'detail' && <BottomNav />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
